---
import "../styles/global.css";

const name = "Federico D'Ubaldi";
const role = "Builder • Data • Automation • Web";
const tagline =
  "Progetto e sviluppo strumenti digitali in modo pratico e veloce, trasformando idee in demo funzionanti.";

/*
  PROGETTI - Aggiornati con link reali
*/
const featured = [
  {
    title: "Flagship Project (Placeholder)",
    desc: "Il progetto principale: problema chiaro, soluzione concreta, demo e case study completi (in arrivo).",
    tags: ["Product", "Data", "Automation", "Web"],
    href: "/projects/flagship",
    status: "In progress",
  },
  {
    title: "Smart Data Cleaning & Reporting",
    desc: "Clean datasets + KPI + report pronti da condividere, partendo da export reali e sporchi.",
    tags: ["Python", "Data Quality", "Reporting", "CLI Tool"],
    href: "/projects/smart-data-cleaning",
    status: "In progress",
  },
  {
    title: "Project Placeholder #3",
    desc: "Un esperimento più advanced: AI/ML o ricerca tecnica con approccio demo-first.",
    tags: ["AI", "ML", "Experiment"],
    href: "/projects/placeholder-3",
    status: "Planned",
  },
];

const toolbox = [
  { label: "Python", note: "data cleaning, automation, report" },
  { label: "FastAPI", note: "API + microservizi" },
  { label: "SQL", note: "query, KPI, model building" },
  { label: "Docker", note: "deploy & reproducibility" },
  { label: "Astro", note: "landing / portfolio" },
  { label: "Tailwind", note: "UI veloce e pulita" },
];

const nowItems = [
  {
    title: "Dashino",
    desc: "Micro-servizio SaaS per pulizia dati e dashboard mensili. Demo e onboarding “idiot-proof” in corso.",
  },
  {
    title: "Portfolio",
    desc: "Costruzione di case study demo-first (1 flagship + 2 progetti operativi).",
  },
  {
    title: "Studio & crescita",
    desc: "Statistica & Big Data + focus su data products e automazioni per business.",
  },
];

const year = new Date().getFullYear();
---

<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{name} — Portfolio</title>
    <meta
      name="description"
      content="Portfolio di Federico D'Ubaldi: progetti data, automation e web, con demo e output concreti."
    />
    <meta name="theme-color" content="#09090b" />

    <style>
      html {
        scroll-behavior: smooth;
      }

      /* (offset sticky header) */
      #top,
      #projects,
      #about,
      #now,
      #toolbox,
      #contact {
        scroll-margin-top: 110px;
      }

      /* ----------------------------------------
        Page transitions (overlay)
      ---------------------------------------- */
      .page-transition {
        position: fixed;
        inset: 0;
        pointer-events: none;
        opacity: 0;
        background: radial-gradient(
            1200px 600px at 20% 20%,
            rgba(139, 92, 246, 0.18),
            transparent 60%
          ),
          radial-gradient(
            1000px 500px at 80% 40%,
            rgba(59, 130, 246, 0.14),
            transparent 60%
          ),
          linear-gradient(
            to bottom,
            rgba(9, 9, 11, 0.92),
            rgba(9, 9, 11, 0.96)
          );
        transform: translateZ(0);
        transition: opacity 220ms ease, filter 220ms ease;
        filter: blur(6px);
        z-index: 9999;
      }
      .page-transition.active {
        opacity: 1;
        pointer-events: all;
        filter: blur(0px);
      }

      /* ----------------------------------------
        “Dock tabs” (scroll spy)
      ---------------------------------------- */
      .tab-link {
        transition: background 160ms ease, border-color 160ms ease,
          box-shadow 200ms ease, transform 200ms ease;
      }
      .tab-link.active {
        background: rgba(255, 255, 255, 0.12) !important;
        border-color: rgba(255, 255, 255, 0.28) !important;
        box-shadow: 0 0 0 1px rgba(139, 92, 246, 0.18),
          0 0 22px rgba(139, 92, 246, 0.14);
        transform: translateY(-1px);
      }

      /* ----------------------------------------
        Neon “grid” background canvas
      ---------------------------------------- */
      #spark {
        position: fixed;
        inset: 0;
        width: 100vw;
        height: 100vh;
        z-index: -1;
        opacity: 0.55;
        pointer-events: none;
      }

      /* ----------------------------------------
        Logo rendering (PNG non quadrato)
      ---------------------------------------- */
      .logo-wrap {
        width: 36px;
        height: 36px;
        border-radius: 12px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: grid;
        place-items: center;
        padding: 6px; /* <-- DISTANZA */
      }
      .logo-img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }
    </style>
  </head>

  <body
    class="bg-zinc-950 text-zinc-50 selection:bg-violet-400/30 selection:text-zinc-50"
  >
    <div class="page-transition" id="pageTransition"></div>
    <canvas id="spark"></canvas>

    <div id="top" class="sr-only"></div>

    <header
      class="sticky top-0 z-50 border-b border-white/10 bg-zinc-950/70 backdrop-blur-xl"
    >
      <div
        class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3"
      >
        <a href="/" class="flex items-center gap-3">
          <div class="logo-wrap">
            <img src="/fd-logo.svg" alt="FD logo" class="logo-img" />
          </div>
          <div class="leading-tight">
            <div class="text-sm font-semibold">{name}</div>
            <div class="text-xs text-white/60">{role}</div>
          </div>
        </a>

        <nav class="hidden md:flex items-center gap-2 text-xs">
          {
            [
              ["Overview", "#top"],
              ["Projects", "#projects"],
              ["About", "#about"],
              ["Now", "#now"],
              ["Toolbox", "#toolbox"],
              ["Contact", "#contact"],
            ].map(([label, hash]) => (
              <a
                class="tab-link rounded-full border border-white/10 bg-white/5 px-3 py-1.5 hover:bg-white/10"
                href={hash}
                data-href={hash}
              >
                {label}
              </a>
            ))
          }
        </nav>

        <a
          href="/#contact"
          class="md:hidden rounded-xl border border-white/10 bg-white/5 px-3 py-2 text-xs font-semibold hover:bg-white/10"
        >
          Contatto
        </a>
      </div>
    </header>

    <main class="mx-auto max-w-6xl px-4 pb-24 pt-10">
      <section
        class="relative overflow-hidden rounded-3xl border border-white/10 bg-white/5 p-8 md:p-12"
      >
        <div class="max-w-2xl">
          <div
            class="inline-flex items-center gap-2 rounded-full border border-white/10 bg-white/5 px-3 py-1 text-xs"
          >
            <span class="inline-block h-2 w-2 rounded-full bg-violet-400"></span>
            in progress • demo-first
          </div>

          <h1 class="mt-5 text-4xl font-semibold tracking-tight md:text-5xl">
            Progetti data & automation, con output concreti.
          </h1>

          <p class="mt-4 text-white/70">{tagline}</p>

          <div class="mt-7 flex flex-wrap gap-3">
            <a
              href="/#projects"
              class="rounded-xl bg-zinc-50 px-4 py-2 text-sm font-semibold text-zinc-950 hover:bg-white"
            >
              Vedi i progetti
            </a>
            <a
              href="/#contact"
              class="rounded-xl border border-white/15 bg-white/5 px-4 py-2 text-sm font-semibold text-white hover:bg-white/10"
            >
              Contattami
            </a>
          </div>

          <div class="mt-7 grid grid-cols-2 gap-3 md:grid-cols-4">
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <div class="text-xs text-white/60">Focus</div>
              <div class="mt-1 text-sm font-semibold">Data Quality</div>
            </div>
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <div class="text-xs text-white/60">Output</div>
              <div class="mt-1 text-sm font-semibold">KPI + Report</div>
            </div>
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <div class="text-xs text-white/60">Metodo</div>
              <div class="mt-1 text-sm font-semibold">Demo-first</div>
            </div>
            <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
              <div class="text-xs text-white/60">Stack</div>
              <div class="mt-1 text-sm font-semibold">Python • Web</div>
            </div>
          </div>
        </div>
      </section>

      <section id="projects" class="mt-10">
        <div class="flex items-end justify-between gap-6">
          <div>
            <h2 class="text-2xl font-semibold tracking-tight">Progetti</h2>
            <p class="mt-2 text-white/65">
              Case study pratici: problema → soluzione → output. Niente fuffa.
            </p>
          </div>
          <a
            href="/#projects"
            class="hidden sm:inline-flex rounded-xl border border-white/10 bg-white/5 px-4 py-2 text-sm font-semibold hover:bg-white/10"
          >
            Torna ai progetti
          </a>
        </div>

        <div class="mt-6 grid gap-4 md:grid-cols-3">
          {
            featured.map((p) => (
              <a
                href={p.href}
                class="group rounded-3xl border border-white/10 bg-white/5 p-6 hover:bg-white/10 transition"
                data-transition-link
              >
                <div class="flex items-center justify-between gap-3">
                  <div class="text-xs text-white/60">{p.status}</div>
                  <div class="text-xs text-white/60">→</div>
                </div>

                <div class="mt-3 text-lg font-semibold">{p.title}</div>
                <p class="mt-2 text-sm text-white/65">{p.desc}</p>

                <div class="mt-4 flex flex-wrap gap-2">
                  {p.tags.map((t) => (
                    <span class="rounded-full border border-white/10 bg-white/5 px-2.5 py-1 text-xs text-white/70">
                      {t}
                    </span>
                  ))}
                </div>
              </a>
            ))
          }
        </div>
      </section>

      <section id="about" class="mt-12">
        <div class="grid gap-4 md:grid-cols-3">
          <div class="md:col-span-2 rounded-3xl border border-white/10 bg-white/5 p-7">
            <h2 class="text-2xl font-semibold tracking-tight">About</h2>
            <p class="mt-3 text-white/70 leading-relaxed">
              Sono un builder orientato al risultato: prendo un problema concreto,
              lo scompongo e costruisco una demo che produce output misurabili
              (dataset puliti, KPI, report, automazioni).
            </p>
            <p class="mt-3 text-white/70 leading-relaxed">
              Mi interessano soprattutto: data quality, strumenti “idiot-proof”,
              e prodotti che trasformano dati in decisioni.
            </p>
          </div>

          <div class="rounded-3xl border border-white/10 bg-white/5 p-7">
            <div class="text-xs text-white/60">Quick facts</div>
            <ul class="mt-4 space-y-3 text-sm text-white/75">
              <li class="flex items-center justify-between gap-3">
                <span>Approccio</span><span class="text-white/60">demo-first</span>
              </li>
              <li class="flex items-center justify-between gap-3">
                <span>Output</span><span class="text-white/60">KPI/report</span>
              </li>
              <li class="flex items-center justify-between gap-3">
                <span>Priorità</span><span class="text-white/60">chiarezza</span>
              </li>
              <li class="flex items-center justify-between gap-3">
                <span>Focus</span><span class="text-white/60">data quality</span>
              </li>
            </ul>
          </div>
        </div>
      </section>

      <section id="now" class="mt-12">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-7">
          <h2 class="text-2xl font-semibold tracking-tight">Now</h2>
          <p class="mt-2 text-white/65">Cosa sto facendo in questo periodo.</p>

          <div class="mt-6 grid gap-4 md:grid-cols-3">
            {nowItems.map((i) => (
              <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
                <div class="text-sm font-semibold">{i.title}</div>
                <p class="mt-2 text-sm text-white/70">{i.desc}</p>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section id="toolbox" class="mt-12">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-7">
          <h2 class="text-2xl font-semibold tracking-tight">Toolbox</h2>
          <p class="mt-2 text-white/65">
            Strumenti che uso spesso (e che porto nei progetti).
          </p>

          <div class="mt-6 grid gap-3 sm:grid-cols-2 md:grid-cols-3">
            {toolbox.map((t) => (
              <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
                <div class="text-sm font-semibold">{t.label}</div>
                <div class="mt-1 text-xs text-white/60">{t.note}</div>
              </div>
            ))}
          </div>
        </div>
      </section>

      <section id="contact" class="mt-12">
        <div class="rounded-3xl border border-white/10 bg-white/5 p-7">
          <h2 class="text-2xl font-semibold tracking-tight">Contatto</h2>
          <p class="mt-2 text-white/65">
            Vuoi vedere una demo o parlare di un progetto? Scrivimi.
          </p>

          <div class="mt-5 flex flex-wrap gap-3 text-sm">
            <a
              href="mailto:TUAEMAIL@example.com"
              class="rounded-xl bg-zinc-50 px-4 py-2 font-semibold text-zinc-950 hover:bg-white"
            >
              Email
            </a>
            <a
              href="#"
              class="rounded-xl border border-white/15 bg-white/5 px-4 py-2 font-semibold text-white hover:bg-white/10"
            >
              LinkedIn
            </a>
            <a
              href="https://github.com/xDubby"
              target="_blank"
              rel="noreferrer"
              class="rounded-xl border border-white/15 bg-white/5 px-4 py-2 font-semibold text-white hover:bg-white/10"
            >
              GitHub
            </a>
          </div>
        </div>
      </section>
    </main>

    <footer class="border-t border-white/10 bg-zinc-950/40">
      <div class="mx-auto max-w-6xl px-4 py-10 text-sm text-white/60">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
          <div>© {year} {name}</div>
          <div class="flex items-center gap-3">
            <a href="/#projects" class="hover:text-white" data-transition-link>Progetti</a>
            <a href="/#contact" class="hover:text-white">Contatto</a>
          </div>
        </div>
      </div>
    </footer>

    <script>
      // ----------------------------
      // Page transition overlay
      // ----------------------------
      const overlay = document.getElementById("pageTransition");

      function showTransition() {
        overlay?.classList.add("active");
      }
      function hideTransition() {
        overlay?.classList.remove("active");
      }

      document.addEventListener("click", (e) => {
        const a = e.target.closest("a[data-transition-link]");
        if (!a) return;

        const href = a.getAttribute("href");
        if (!href) return;

        // ignore hashes, external, new tabs
        if (href.startsWith("#")) return;
        if (href.startsWith("/#")) return;
        if (a.target === "_blank") return;
        if (href.startsWith("http")) return;

        e.preventDefault();
        showTransition();
        setTimeout(() => {
          window.location.href = href;
        }, 140);
      });

      window.addEventListener("pageshow", hideTransition);

      // ----------------------------
      // Tabs scroll spy (fix toolbox/contact)
      // ----------------------------
      const tabLinks = Array.from(document.querySelectorAll(".tab-link"));

      function activateTabByHash(hash) {
        tabLinks.forEach((l) => l.classList.remove("active"));
        const active = tabLinks.find((l) => l.getAttribute("data-href") === hash);
        if (active) active.classList.add("active");
      }

      const sectionIds = ["#top", "#projects", "#about", "#now", "#toolbox", "#contact"];
      const headerOffset = 110; // uguale al tuo scroll-margin-top

      function pageBottomForce() {
        return window.innerHeight + window.scrollY >= document.body.offsetHeight - 6;
      }

      function getActiveSection() {
        if (pageBottomForce()) return "#contact";

        let current = "#top";

        for (const id of sectionIds) {
          const el = document.querySelector(id);
          if (!el) continue;

          // distanza del top della sezione dal top viewport
          const top = el.getBoundingClientRect().top;

          // se il top della sezione è sopra (o vicino) l'header, considerala "raggiunta"
          if (top <= headerOffset + 8) current = id;
        }

        return current;
      }

      function onScrollSpy() {
        activateTabByHash(getActiveSection());
      }

      window.addEventListener("scroll", onScrollSpy, { passive: true });
      window.addEventListener("resize", onScrollSpy);
      onScrollSpy();

      // ----------------------------
      // Background canvas (spark)
      // ----------------------------
      const canvas = document.getElementById("spark");
      const ctx = canvas?.getContext("2d");

      function resize() {
        if (!canvas || !ctx) return;
        const dpr = window.devicePixelRatio || 1;
        canvas.width = Math.floor(window.innerWidth * dpr);
        canvas.height = Math.floor(window.innerHeight * dpr);
        // Normalizza lo scaling così le linee restano consistenti
        ctx.setTransform(1, 0, 0, 1, 0, 0);
      }

      window.addEventListener("resize", resize);
      resize();

      const N = 52;

      const points = Array.from({ length: N }).map(() => ({
        x: Math.random(),
        y: Math.random(),
        vx: (Math.random() - 0.5) * 0.0006,
        vy: (Math.random() - 0.5) * 0.0006,
        z: Math.random(),
      }));

      function tick() {
        if (!canvas || !ctx) return;

        const w = canvas.width;
        const h = canvas.height;

        ctx.clearRect(0, 0, w, h);

        // move
        for (const p of points) {
          p.x += p.vx;
          p.y += p.vy;
          if (p.x < 0 || p.x > 1) p.vx *= -1;
          if (p.y < 0 || p.y > 1) p.vy *= -1;
        }

        // lines
        for (let i = 0; i < points.length; i++) {
          for (let j = i + 1; j < points.length; j++) {
            const a = points[i];
            const b = points[j];
            const dx = a.x - b.x;
            const dy = a.y - b.y;
            const d = Math.sqrt(dx * dx + dy * dy);

            if (d < 0.14) {
              const alpha = (1 - d / 0.14) * 0.22;
              ctx.strokeStyle = `rgba(255,255,255,${alpha})`;
              ctx.lineWidth = 1;
              ctx.beginPath();
              ctx.moveTo(a.x * w, a.y * h);
              ctx.lineTo(b.x * w, b.y * h);
              ctx.stroke();
            }
          }
        }

        // dots
        for (const s of points) {
          ctx.beginPath();
          ctx.arc(s.x * w, s.y * h, 2 + s.z * 2, 0, Math.PI * 2);
          ctx.fillStyle = `rgba(139,92,246,${0.06 + s.z * 0.12})`;
          ctx.fill();
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    </script>
  </body>
</html>
